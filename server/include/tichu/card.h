#ifndef SRC_CARD_H
#define SRC_CARD_H

#include <libchaos/ini.h>

#include "tichu.h"

/* -------------------------------------------------------------------------- *
 * Constants                                                                  *
 * -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- *
 * Types                                                                      *
 * -------------------------------------------------------------------------- */
struct card {
  struct node     node;          /* node for lclient_list */
  uint32_t        serial;
  uint32_t        refcount;      /* how many times this block is referenced */
  uint32_t        hash;
  int             choose;        /* Jokerkarte wenn 1, erlaube dem Spieler eine Karte zu wählen */
  char            name[3];
  int             points;
  int             value;
};

/* -------------------------------------------------------------------------- *
 * Global variables                                                           *
 * -------------------------------------------------------------------------- */
extern int             card_log;
extern struct sheap    card_heap;     /* heap for card_t */
extern uint32_t        card_serial;
extern struct list     card_list;     /* list with all of them */

/* -------------------------------------------------------------------------- *
 * -------------------------------------------------------------------------- */

/* -------------------------------------------------------------------------- *
 * Initialize card module                                                  *
 * -------------------------------------------------------------------------- */
extern void            card_init         (void);

/* -------------------------------------------------------------------------- *
 * Shutdown card module                                                    *
 * -------------------------------------------------------------------------- */
extern void            card_shutdown     (void);

/* -------------------------------------------------------------------------- *
 * Garbage collect card data                                               *
 * -------------------------------------------------------------------------- */
extern void            card_collect      (void);

/* -------------------------------------------------------------------------- *
 * Load all card from INI file                                                          *
 * -------------------------------------------------------------------------- */
extern void            card_load         (struct ini *ini);

/* -------------------------------------------------------------------------- *
 * Create a new card block                                                 *
 * -------------------------------------------------------------------------- */
extern struct card    *card_new          (const char *name);

/* -------------------------------------------------------------------------- *
 * Delete a  card block                                                    *
 * -------------------------------------------------------------------------- */
extern void            card_delete       (struct card  *lcptr);

/* -------------------------------------------------------------------------- *
 * Loose all references of an card block                                    *
 * -------------------------------------------------------------------------- */
extern void            card_release      (struct card  *lcptr);

/* -------------------------------------------------------------------------- *
 * Find a card by its name                                                 *
 * -------------------------------------------------------------------------- */
extern struct card    *card_find_name    (struct list     *list,
                                          const char      *name);

/* -------------------------------------------------------------------------- *
 * Find a card by its id                                                      *
 * -------------------------------------------------------------------------- */
extern struct card    *card_find_id      (uint32_t        id);

/* -------------------------------------------------------------------------- *
 * Dump cards and card heap.                                            *
 * -------------------------------------------------------------------------- */
extern void            card_dump         (struct card  *lcptr);
  
#endif /* SRC_card_H */
